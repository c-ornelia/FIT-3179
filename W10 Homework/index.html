<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pokémon Go Interest & Defender Rankings</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: white;
      text-align: center;
    }

    h2 {
      margin: 30px 0 10px 0;
    }

    .vis-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100%;
    }

    .vis-container {
      background-color: white;
      width: 1100px; /* wide enough for vertical bars */
      margin-bottom: 50px;
      text-align: center;
    }

    select, label {
      font-size: 14px;
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <div class="vis-wrapper">
    <!-- Map -->
    <h2>Relative Pokémon Go Interest, Malaysian States (21–28 Sep 2025)</h2>
    <div id="mapVis" class="vis-container"></div>

    <!-- Bar Chart -->
    <h2>Best Defenders by Tier</h2>
    <div id="barVis" class="vis-container"></div>
  </div>

  <script type="text/javascript">
    // ----- MAP SPEC -----
    const mapSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "width": 900,
      "height": 400,
      "background": "white",
      "projection": {"type": "mercator"},
      "layer": [
        {
          "data": {
            "url": "malaysia.json",
            "format": {"type": "topojson", "feature": "my"}
          },
          "transform": [
            {
              "lookup": "properties.name",
              "from": {
                "data": {"url": "geomap.csv"},
                "key": "Region",
                "fields": ["Interest"]
              }
            }
          ],
          "mark": {"type": "geoshape", "stroke": "#333", "strokeWidth": 0.5},
          "encoding": {
            "color": {
              "field": "Interest",
              "type": "quantitative",
              "scale": {"scheme": "blues"},
              "title": "Relative Interest Score"
            },
            "tooltip": [
              {"field": "properties.name", "title": "State: "},
              {"field": "Interest", "title": "Relative Interest Score: ",}
            ]
          }
        },
        {
          "data": {
            "url": "malaysia.json",
            "format": {"type": "topojson", "feature": "ne_110m_graticules_1"}
          },
          "mark": {"type": "geoshape", "stroke": "#cccccc", "strokeWidth": 0.5}
        }
      ]
    };

    // ----- VERTICAL BAR CHART SPEC -----
    const barSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "description": "Pokémon defender bar chart by score",
      "width": 900, // wide for labels
      "height": 400,
      "background": "white",
      "padding": {"bottom": 70}, // extra for rotated x labels
      "data": { "url": "defenders.csv" },

      "params": [
        {
          "name": "tierSelect",
          "value": "S",
          "bind": {
            "input": "select",
            "options": ["S", "A+", "A", "B", "C", "D"],
            "labels": ["S", "A+", "A", "B", "C", "D"],
            "name": "Select Tier: "
          }
        }
      ],

      "transform": [
        { "filter": "datum.Tier == tierSelect" }
      ],

      "layer": [
        {
          "mark": {"type": "bar", "color": "#b6ccfe"},
          "encoding": {
            "x": {
              "field": "Name",
              "type": "ordinal",
              "axis": {
                "title": null,
                "labelAngle": -60,
                "labelAlign": "right",
                "labelFontSize": 12,
                "labelPadding": 10
              }
            },
            "y": {
              "field": "Score",
              "type": "quantitative",
              "title": "Defender Score",
              "scale": {"domain": [0, 80000]},
              "axis": {
                "domain": true,
                "ticks": false,
                "gridColor": "#ededed",
                "gridWidth": 1, 
                "titlePadding": 30,
                "labelPadding": 10
              }
            },
            "tooltip": [
              {"field": "Name", "title": "Pokémon: "},
              {"field": "Tier", "title": "Tier: "},
              {"field": "Score", "title": "Defender Score: "}
            ]
          }
        },
        {
          // bar value labels
          "mark": {
            "type": "text",
            "align": "center",
            "baseline": "bottom",
            "dy": -4,
            "fontSize": 12 // not bold
          },
          "encoding": {
            "x": {"field": "Name", "type": "ordinal", "sort": "-y"},
            "y": {"field": "Score", "type": "quantitative"},
            "text": {"field": "Score", "type": "quantitative"}
          }
        }
      ],

      "config": {
        "axis": {"labelFontSize": 12, "titleFontSize": 14},
        "view": {"stroke": "transparent"}
      }
    };

    // ----- EMBED BOTH -----
    vegaEmbed('#mapVis', mapSpec);
    vegaEmbed('#barVis', barSpec);
  </script>
</body>
</html>
